# 03 단일프로그래밍 환경에서의 메모리 할당

# 1 메모리 오버레이

지금은 메모리의 가격이 부담스럽지 않고 용량도 넉넉하여 문제가 없지만 과거에는 작은 메모리로 큰 프로그램을 어떻게 작동할 것인가가 문제였다. 

프로그램의 크기가 실제 메모리(물리 메모리)보다 클 때 전체 프로그램을 메모리에 가져오는 대신 적당한 크기로 잘라서 가져오는 기법을 메모리 오버레이 memory overlay 라고 한다. ‘overlay’는 겹겹이 쌓다, 중첩시키다 라는 뜻으로, 메모리 오버레이는 하나의 메모리에 여러 프로그램을 겹겹이 쌓아놓고 실행하는 것을 말한다. 

메모리 오버레이의 경우 프로그램을 몇 개의 모듈로 나누고 필요할 때마다 모듈을 메모리에 가져와 사용한다. 전체 프로그램을 메모리에 올려놓고 실행하기에는 메모리의 키그가 작기 때문에 실행하는데 필요한 중요한 모듈만 올려놓고 나머지는 필요할 때마다 메모리에 가져와 사용하는 것이다. 

[그림 7-15]는 메모리 오버레의 작동 방식을 보여준다. 프로그램 전체를 메모리에 올려놓고 실행하는 것보다 속도가 느리지만 메모리가 프로그램보다 작을 때도 실행할 수 있어 유용하다. 

메모리 오버레이에서 어떤 모듈을 가져오거나 내보낼지는 CPU 레지스터 중 하나인 프로그램 카운터 PC가 결정한다. 프로그램 카운터는 앞으로 실행할 명령어의 위치를 가리키는 레지스터로, 해당 모듈이 메모리에 없으면 메모리 관리자에게 요청하여 메모리로 가져오게 한다. 

메모리 오버레이는 다음과 같은 중요한 의미가 있다. 

- 한정된 메모리에서 메모리보다 큰 프로그램의 실행이 가능하다. 이는 다음 장에서 설명할 가상 메모리 시스템의 기본이 되는 개념이다.
- 프로그램 전체가 아니라 일부만 메모리에 올라와도 실행이 가능하다. 프로그램은 개념적으로 한 덩어리지만 일부분만 가지고도 실행할 수 있다. 이는 메모리를 여러 조각으로 나누어 여러 프로세스에 할당할 수 있다는 의미이기도 하다.

---

# 2 스왑

메모리 오버레이를 이용하면 메모리보다 큰 프로그램을 실행할 수 있다. 하지만 처리해야 할 문제가 남아 있다. 

[그림 7-15]에서는 메모리에 모듈 B를 가져올 때 먼저 메모리에 올라온 모듈 A를 어딘가에 보관해야 한다. 쉽게 생각하면 모듈 A를 원래의 하드디스크 위치에 옮겨놓으면 되겠지만, 다시 사용할지도 모르고 아직 작업이 끝나지 않았기 때문에 저장장치의 별도 공간에 저장해야 한다. 이처럼 메모리가 모자라서 쫓겨난 프로세스는 저장장치의 특별한 공간에 모아두는데 이러한 영역을 스왑 영역 swap area 라고 부른다. 그리고 스왑 영역에서 메모리로 데이터를 가져오는 작업은 스왑 인 swap in, 메모리에서 스왑 영역으로 데이터를 내보내는 작업은 스왑 아웃 swap out 이라고 한다. 

스왑 영역은 메모리 관리자가 관리하다. 원래 하드디스크 같은 저장장치는 저장장치 관리자가 관리하지만, 스왑 영역은 메모리에서 쫓겨났다가 다시 돌아가는 데이터가 머무는 곳이기 때문에 저장장치는 장소만 빌려주고 메모리 관리자가 관리하는 것이다. 

메모리 오버레이에서는 메모리보다 큰 프로그램을 실행할 때 프로그램을 메모리보다 작은 크기의 모듈로 나누어서 사용한다. 여기에 스왑을 이용하면 스왑 영역의 크기가 메모리의 크기로 인식된다. 다시 말해 사용자의 실제 메모리의 크기와 스왑 영역의 크기를 합쳐서 전체 메모리로 인식하여 사용할 수 있다. 

예를 들어 실제 메모리의 크기가 1GB, 스왑의 크기가 3GB라면 사용자가 인식하는 메모리는 4GB이다. 이는 실제 메모리가 4GB인 컴퓨터보다 속도가 느리겠지만, 스왑을 사용하면 실제 메모리의 모자란 부분을 보충할 수 있다. 사용자 입장에서는 실제 메모리의 크기에 상관없이 큰 프로그램을 실행할 수 있는 것이다. 

컴퓨터의 전원 메뉴 중 [최대 절전 모드]는 현재 작업 중인 상태 그대로 쉬게 하는 것이다. [다시 시작]이 모든 프로세스를 중지시키고 컴퓨터를 새로 시작하는 것이라면 [최대 절전 모드]는 컴퓨터를 잠시 껐다가 현재 작업 상태로 복귀시키는 것이다. [최대 절전 모드]를 사용하면 CPU와 메모리의 전력 공급을 끊기 때문에 메모리에 있는 내용이 모두 사라진다. 그러므로 원래 작업으로 복귀시키려면 현재 메모리에 있는 데이터를 어딘가에 옮겨야 하는데, 이때 옮겨가는 곳이 스왑 영역이다. [최대 절전 모드]를 실행하면 하드디스크가 깜박거리다가 전원이 꺼지는 것도 바로 이런 이유 때문이다.
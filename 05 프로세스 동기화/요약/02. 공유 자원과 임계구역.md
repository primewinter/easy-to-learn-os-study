# **5\. 프로세스 동기화**

## **5-2. 공유 자원과 임계구역**

-   프로세스는 독립적으로 작업을 할 수도 있고, 공유된 자원을 가지고 공동 작업을 할 수도 있다.
-   **여러 프로세스**가 **한정된 자원**을 가지고 **공동으로 작업**할 때 발생할 수 있는 문제

### **1\. 공유 자원의 접근**

-   **공유 자원(shared resource)**
    -   여러 프로세스가 공동으로 이용하는 변수, 메모리, 파일 등
    -   공동으로 이용되기 때문에, 누가 언제 데이터를 읽거나 쓰느냐에 따라 그 결과가 달라질 수 있다.
    -   그러므로, 프로세스들의 공유 자원 접근 순서를 정해 예상치 못한 문제가 발생하지 않도록 주의해야 한다.
-   **경쟁 조건(race condition)** 의 발생
    -   2개 이상의 프로세스가 공유 자원을 병행적으로 쓰거나 읽는 상황
    -   공유 자원 접근 순서에 따라 실행 결과가 달라질 수 있다.
-   경쟁 조건의 발생 예시  
    ![image](https://user-images.githubusercontent.com/74661937/192089492-310a3d68-3d12-4b9e-ae43-fce3c2d1cb90.png)

### **2\. 임계구역 (critical section)**

-   공유 자원 **접근 순서**에 따라 실행 결과가 달라지는 프로그램 영역
-   각 프로세스가 전역 변수를 사용하는 부분
-   'critical'은 '(앞으로의 상황에 영향을 미친다는 점에서) 대단히 중요한' 이라는 뜻
-   프로세스 실행 상황에서는 **공유할 수 없는 자원이 중요한 자원**
-   ex. 주방에서 3~4개의 화구를 가진 가스레인지는 공유 가능한 자원, 믹서기는 공유가 불가능한 자원.  
    따라서 주방의 임계구역은 믹서기!
-   어떤 프로세스가 임계구역에 들어가면 다른 프로세스는 임계구역 밖에서 기다려야 하며, 임계구역의 프로세스가 나와야 들어갈 수 있다.

### **3\. 생산자-소비자 문자**

-   임계 구역과 관련된 전통적인 문제
-   생산자-소비자 문제에서는 생산자 프로세스와 소비자 프로세스가 서로 독립적으로 작업을 한다.
-   생산자는 계속 물건을 생산해서 버퍼에 넣고\[input(buf)\] 소비자는 계속 버퍼에서 물건을 가져온다\[output(buf)\].
    -   버퍼는 작업을 계속 하기 위해서 원형 버퍼(circular buffer)를 사용한다.
-   버퍼가 비었는지 가득 찼는지 확인하기 위해서 sum이라는 전역 변수를 사용한다.
    -   sum에는 현재 버퍼에 있는 상품의 총수가 저장된다.
-   이 경우, 생산자 코드와 소비자 코드가 동시에 실행되면, 문제가 발생한다.
    -   생산자와 소비자가 전역 변수 sum에 접근하는 타이밍을 서로 맞추지 않았기 때문.  
        
        ![](https://blog.kakaocdn.net/dn/cbGXQL/btrMUGVhqFd/KMcuwot2pK9iS50F8vk7m0/img.png)
        
    -   위 상태에서 (1) 생산자의 `sum=sum+1;`와 (2) 소비자의 `sum=sum-1;`이 거의 동시에 실행되면 문제가 발생한다.
    -   생산자와 소비자가 독립적이기 때문에 상대방이 sum을 바꾸려는 것을 모른 채 현재 상태인 `sum=3`을 읽어서 작업을 한다.
    -   미세한 차를 두고 (1), (2) 또는 (2), (1) 순서로 실행되면 sum 값은 2나 4가 된다.
-   임계 구역은 전역변수 사용시 뿐만 아니라, 하드웨어 자원을 사용할 때도 적용되는 개념이다.
    -   ex. 프린터 1대를 여러 명이 동시에 사용하는 경우 프린터는 임계 구역이다. 하드웨어 자원도 한 번에 한 프로세스만 사용해야하기 때문.

### **4\. 임계구역 해결 조건**

-   임계구역 문제를 해결하기 위해서는 어떤 방법이든 세가지 조건을 만족해야한다.

> **조건 1. 상호 배제(mutual exclusion)**  
> **조건 2. 한정 대기(bounded waiting)**  
> **조건 3. 진행의 융통성(progress flexibility)**

-   **상호 배제**
    -   한 프로세스가 임계 구역에 들어가면, 다른 프로세스는 임계 구역에 들어갈 수 없다.
    -   임계 구역 내에는 한 번에 하나의 프로세스만 있어야 한다.
-   **한정 대기**
    -   어떤 프로세스도 무한 대기(infinite postpone)하지 않아야 한다.
    -   즉, 특정 프로세스가 임계 구역에 진입하지 못하면 안된다.
-   **진행의 융통성**
    -   두 요리사가 번갈아가며 믹서를 사용하기로 했다고 했을 때, 요리사 B가 믹서를 사용한 후 요리사 A가 믹서를 사용할 일이 있든 없든 믹서를 사용할 때까지 기다려야하는 것은 매우 비효율적이다.
    -   요리사 B는 요리사 A의 작업 속도와 관계 없이 믹서가 비어있으면 언제든 사용 가능해야한다.
    -   진행의 융통성은 한 프로세스가 다른 프로세사의 진행을 방해해서는 안된다는 것.

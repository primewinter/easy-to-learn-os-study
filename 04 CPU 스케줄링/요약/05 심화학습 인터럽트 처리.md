# [심화학습] 인터럽트 처리

## 인터럽트 개념
    * 오늘날 운영체제는 입출력 시 인터럽트를 이용하여 시스템의 효율을 높임
    * 인터럽트 처리는 입출력 뿐만 아니라 시스템을 보호하는 데 매우 중요한 작업
    * 과거에는 입출력 처리 요청시 운영체제가 주기적으로 입출력 장치를 직접 확인하여 처리 (폴링 방식)
    * 오늘날에는 인터럽트를 이용하여 입출력을 요청하고 완료시 이벤트를 발생시켜 처리

## 동기적 인터럽트와 비동기적 인터럽트
    * 동기적 인터럽트 (synchronous interrupt)
        - 프로세스가 실행 중인 명령어로 인해 발생하는 동기적 인터럽트
        - example
            - 프로그램상의 문제 때문에 발생하는 인터럽트 (다른 사용자 메모리에 접근, 오버플로 등)
            - 작업자가 의도적으로 프로세스를 중단하기 위해 발생시킨 인터럽트
            - 입출력 장치와 같은 주변 장치의 조작에 의한 인터럽트
            - 산술 연산 중 발생하는 인터럽트
    * 비동기적 인터럽트 (asynchronous interrupt)
        - 실행 중인 명령어와 무관하게 발생
        - example
            - 하드웨어적인 오류 (하드디스크 읽기 오류, 메모리 불량)
            - 사용자가 직접 작동 (키보드 인터럽트, 마우스 인터럽트)

## 인터럽트 처리 과정
    * 각각의 인터럽트에는 고유번호(인터럽트 번호, IRQ)가 있음
    * 시스템에 인터럽트가 발생하면 IRQ로 식별
    * 인터럽트는 동시에 발생할 수 있는데, 이를 묶어서 처리하는 개념을 인터럽트 백터라고 함
    * 인터럽트가 발생하면 인터럽트 벡터의 번호가 0 -> 1로 바뀜 (동시에 여러 개가 바뀔 수 있음)
    * 인터럽트 백터에는 해당 인터럽트가 발생하면 어떤 일을 처리할 것인지에 대한 함수가 연결 되어 있는데, 이를 인터럽트 핸들러라고 함
    * 모든 인터럽트에는 기본적으로 핸들러가 정의되어 있고, 사용자가 커스텀 가능
    * 인터럽트 처리 과정
        1. 인터럽트 발생
        2. 현재 실행 중인 프로세스는 일시 정지 상태가 됨
        3. 재시작을 위해 현재 프로세스 관련 정보를 임시로 저장
        4. 인터럽트 컨트롤러가 실행되어 인터럽트의 처리 순서를 결정 (인터럽트의 우선순위를 고려)
        5. 처리할 인터럽트가 결정되면 인터럽트 벡터에 등록된 인터럽트 핸들러가 실행됨
        6. 핸들러가 처리를 마치면 일시 정지된 프로세스가 다시 실행되거나 종료됨

## 인터럽트와 이중 모드
<img alt="pcb image" src="./images/05_interrupt.jpg.PNG">

    * 프로세스는 크게 커널 프로세스와 사용자 프로세스로 나뉨
    * 운영체제와 관련된 커널 프로세스가 실행되는 상태를 커널 모드(kernal mode)라고 함
    * 사용자 프로세스가 실행되는 상태를 사용자 모드(user mode)라고 함
    * 사용자 프로세스가 하드디스크 입출력, 프로세스 생성 등과 같이 커널 기능을 사용할 떄 시스템 호출을 이용하여 커널 프로세스에 작업을 요청해야 함
    * 사용자 프로세스는 시스템 호출을 요청한 후 대기 상태로 전환되고 커널 프로세스는 요청 받은 작업을 처리 (사용자 모드 -> 커널 모드)
    * 운영체제가 위 처럼 두 모드를 전환하며 일을 처리하는 것을 이중 모드(dual mode)라고 함
    * 이중 모드는 운영체제가 자원을 보호하기 위해 사용하는 기법 (커널은 시스템 호출을 통해서만 접근하도록 제한)
    * 다양한 방법으로 시스템 호출을 사용하기 위해서 운영체제는 API(Application Programming Interface) 제공
    * 사용자가 커널 모드로 진입하는 경우
        - 시스템 호출 사용
            - 자발적 진입
            - 자발적으로 커널 모드에 진입할 수 있는 유일한 수단
        - 인터럽트 발생
            - 비자발적 진입
            - 인터럽트를 발생시켰다는 것은 잘못된 명령을 수행하여 동기적 인터럽트가 발생한 것이고 프로세스가 강제 종료됨
